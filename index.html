<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>geoLocus - L√§n, kommun och landskap i ett klick!</title>
  
  <!-- Stylesheet -->
  <link rel="stylesheet" href="style.css">
  
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
</head>
<body>
  <div class="app-container">
<!-- HEADER -->
    <header>
      <div class="snowflake">‚ùÑ</div>
      <div class="snowflake">‚ùÖ</div>
      <div class="snowflake">‚ùÜ</div>
      <div class="snowflake">‚ùÑ</div>
      <div class="snowflake">‚ùÖ</div>
      <div class="snowflake">‚ùÜ</div>
      <div class="snowflake">‚ùÑ</div>
      <div class="snowflake">‚ùÖ</div>
      <div class="snowflake">‚ùÜ</div>
      
      <div class="header-content">
        <div class="logo-section">
          <div class="brand-text">
            <h1>geoLocus</h1>
            <p>L√§n, kommun och landskap i ett klick!</p>
          </div>
        </div>
        
<nav class="tab-nav">
          <button class="tab-button active" onclick="openTab('main')">
            Karta
          </button>
          <button class="tab-button" onclick="openTab('converter')">
            Konvertera
          </button>
          <button class="tab-button" onclick="openTab('visa-pa-karta')">
            Visa koordinater p√• karta
          </button>
          <button class="tab-button" onclick="openTab('h√§mta-geodata')">
            H√§mta geodata
          </button>
        </nav>
      </div>
    </header>

    <!-- MAIN CONTENT AREA -->
    <div class="content-area">
      
      <!-- TAB 1: KARTA (Full-screen map) -->
      <div id="main" class="tab-content active">
        <div id="map-view">
          <div id="map"></div>
          
          <!-- Search controls overlaid on map - TOP LEFT -->
          <div class="map-controls">
            <div class="search-panel">
              <div class="search-header">
                <div class="search-row">
                  <input id="searchField" type="text" placeholder="S√∂k plats eller koordinat...">
                  <button id="searchButton">S√∂k</button>
                </div>
                <div class="button-row">
                  <button id="clearPinsButton" class="secondary" style="width: 100%;">Rensa pins</button>
                </div>
              </div>
              
              <div id="results"></div>
              
              <!-- Filters -->
              <div class="filters-panel">
                <div class="filters-toggle" onclick="toggleFilters()">
                  <span>S√∂kfilter</span>
                  <span id="filter-arrow">‚ñº</span>
                </div>
                <div class="filters-content" id="filters-content">
                  <div class="filter-group">
                    <label>
                      <input type="checkbox" id="worldwideToggle">
                      Till√•t s√∂ktr√§ffar utanf√∂r Sverige
                    </label>
                  </div>
                  
                  <div class="filter-group">
                    <select id="filterLan">
                      <option value="">Alla l√§n</option>
                      <option value="Blekinge l√§n">Blekinge l√§n</option>
                      <option value="Dalarnas l√§n">Dalarnas l√§n</option>
                      <option value="Gotlands l√§n">Gotlands l√§n</option>
                      <option value="G√§vleborgs l√§n">G√§vleborgs l√§n</option>
                      <option value="Hallands l√§n">Hallands l√§n</option>
                      <option value="J√§mtlands l√§n">J√§mtlands l√§n</option>
                      <option value="J√∂nk√∂pings l√§n">J√∂nk√∂pings l√§n</option>
                      <option value="Kalmar l√§n">Kalmar l√§n</option>
                      <option value="Kronobergs l√§n">Kronobergs l√§n</option>
                      <option value="Norrbottens l√§n">Norrbottens l√§n</option>
                      <option value="Sk√•ne l√§n">Sk√•ne l√§n</option>
                      <option value="Stockholms l√§n">Stockholms l√§n</option>
                      <option value="S√∂dermanlands l√§n">S√∂dermanlands l√§n</option>
                      <option value="Uppsala l√§n">Uppsala l√§n</option>
                      <option value="V√§rmlands l√§n">V√§rmlands l√§n</option>
                      <option value="V√§sterbottens l√§n">V√§sterbottens l√§n</option>
                      <option value="V√§sternorrlands l√§n">V√§sternorrlands l√§n</option>
                      <option value="V√§stmanlands l√§n">V√§stmanlands l√§n</option>
                      <option value="V√§stra G√∂talands l√§n">V√§stra G√∂talands l√§n</option>
                      <option value="√ñrebro l√§n">√ñrebro l√§n</option>
                      <option value="√ñsterg√∂tlands l√§n">√ñsterg√∂tlands l√§n</option>
                    </select>
                    
                    <select id="filterLandskap">
                      <option value="">Alla landskap</option>
                      <option value="Blekinge">Blekinge</option>
                      <option value="Bohusl√§n">Bohusl√§n</option>
                      <option value="Dalarna">Dalarna</option>
                      <option value="Dalsland">Dalsland</option>
                      <option value="Gotland">Gotland</option>
                      <option value="G√§strikland">G√§strikland</option>
                      <option value="Halland">Halland</option>
                      <option value="H√§lsingland">H√§lsingland</option>
                      <option value="H√§rjedalen">H√§rjedalen</option>
                      <option value="J√§mtland">J√§mtland</option>
                      <option value="Medelpad">Medelpad</option>
                      <option value="Norrbotten">Norrbotten</option>
                      <option value="N√§rke">N√§rke</option>
                      <option value="Sk√•ne">Sk√•ne</option>
                      <option value="Sm√•land">Sm√•land</option>
                      <option value="S√∂dermanland">S√∂dermanland</option>
                      <option value="Uppland">Uppland</option>
                      <option value="V√§rmland">V√§rmland</option>
                      <option value="V√§sterbotten">V√§sterbotten</option>
                      <option value="V√§sterg√∂tland">V√§sterg√∂tland</option>
                      <option value="V√§stmanland">V√§stmanland</option>
                      <option value="√Öngermanland">√Öngermanland</option>
                      <option value="√ñland">√ñland</option>
                      <option value="√ñsterg√∂tland">√ñsterg√∂tland</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Info buttons - BOTTOM CENTER -->
          <div class="info-buttons">
            <button class="info-btn" onclick="openModal('tips')">üí° S√∂ktips</button>
            <button class="info-btn" onclick="openModal('sources')">‚ÑπÔ∏è Datak√§llor</button>
          </div>
        </div>
      </div>

      <!-- TAB 2: KONVERTERA -->
      <div id="converter" class="tab-content">
        <div class="page-content">
          <div class="card">
            <div class="section-header">
              <h2>Konvertera koordinater</h2>
            </div>

            <div class="converter-grid">
              <input type="text" id="wgs84Input" placeholder="WGS84 (Lat, Lon)">
              <input type="text" id="rt90Input" placeholder="RT90 2.5 gon V (Nord, Ost)">
              <input type="text" id="swerefInput" placeholder="SWEREF99 TM (Nord, Ost)">
              <button id="convertButton">Konvertera</button>
            </div>

            <div class="converter-results">
              <h3>Resultat</h3>
              <div class="result-row">
                <span class="result-label">WGS84:</span>
                <span class="result-value" id="wgs84Result">-</span>
              </div>
              <div class="result-row">
                <span class="result-label">RT90 2.5 gon V:</span>
                <span class="result-value" id="rt90Result">-</span>
              </div>
              <div class="result-row">
                <span class="result-label">SWEREF99 TM:</span>
                <span class="result-value" id="swerefResult">-</span>
              </div>
            </div>
          </div>
        </div>
      </div>

            <!-- TAB 3: VISA KOORDINATER P√Ö KARTA -->
      <div id="visa-pa-karta" class="tab-content">
        <div id="map-view-upload">
          <div id="map-upload"></div>
          
          <!-- Upload controls overlaid on map -->
          <div class="upload-controls">
            <div class="upload-panel">
              <h3>Ladda upp koordinater</h3>
              <p style="margin-bottom: 1rem; font-size: 0.875rem; color: #64748b;">
                Ladda upp en Excel-fil med kolumnerna: <code>lat</code>, <code>lon</code>, <code>namn</code>
              </p>
              
              <div class="upload-area-compact">
                <label for="coordFile" class="custom-file-upload">
                  V√§lj Excel-fil
                </label>
                <input type="file" id="coordFile" accept=".xlsx,.xls,.csv" />
              </div>
              
              <span id="coordFileName" class="file-info"></span>
              
              <button id="clearMapPinsBtn" class="secondary" style="width: 100%; margin-top: 0.75rem;">
                Rensa kartan
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- TAB 4: H√ÑMTA GEODATA -->
      <div id="h√§mta-geodata" class="tab-content">
        <div class="page-content">
          <div class="card">
            <div class="section-header">
              <h2>H√§mta geodata fr√•n koordinater</h2>
            </div>

            <p style="margin-bottom: 1.5rem;">Ladda upp en Excel-fil med koordinater och f√• tillbaka en fil d√§r varje punkt kopplats till l√§n, landskap (eller lappmark), kommun, socken och adress.</p>

            <div class="info-box">
              <h3>V√§lj datak√§lla</h3>
              <div class="radio-group">
                <label>
                  <input type="radio" name="dataSource" value="lmOnly">
                  <span>H√§mta endast l√§n, kommun, landskap (snabbare)</span>
                </label>
                <label>
                  <input type="radio" name="dataSource" value="both" checked>
                  <span>H√§mta fullst√§ndig data (inkluderar √§ven socken, adress)</span>
                </label>
              </div>
            </div>

            <div class="upload-area">
              <label for="excelFile" class="custom-file-upload">
                V√§lj Excel-fil
              </label>
              <input type="file" id="excelFile" accept=".xlsx,.xls" />
              <button id="processBtn">H√§mta geodata</button>
              <span id="selectedFileName" class="file-info"></span>
            </div>

            <details>
              <summary>Filformat & krav</summary>
              <div class="details-content">
                <p>Filen du laddar upp ska vara i <strong>Excel-format</strong> (<code>.xlsx</code> eller <code>.xls</code>) och inneh√•lla f√∂ljande kolumner:</p>
                <table>
                  <tbody>
                    <tr>
                      <td><code>id</code></td>
                      <td>Unikt rad-ID (t.ex. katalognummer eller lokal-id; <em>valfritt</em>)</td>
                    </tr>
                    <tr>
                      <td><code>lat</code></td>
                      <td>Latitud i decimaltal</td>
                    </tr>
                    <tr>
                      <td><code>lon</code></td>
                      <td>Longitud i decimaltal</td>
                    </tr>
                  </tbody>
                </table>
                
                <div class="info-box" style="margin-top: 1rem;">
                  <h3>Viktigt</h3>
                  <ul>
                    <li>Kolumnnamnen m√•ste skrivas exakt som ovan (sm√• bokst√§ver)</li>
                    <li>Koordinaterna ska vara i WGS84</li>
                    <li>Decimaler ska anges med punkt (<code>.</code>), inte komma (<code>,</code>)</li>
                  </ul>
                </div>
              </div>
            </details>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- MODALS -->
  <!-- Search Tips Modal -->
  <div id="tipsModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>S√∂ktips</h3>
        <button class="modal-close" onclick="closeModal('tips')">&times;</button>
      </div>
      <div class="modal-body">
        <ul>
          <li>Du kan s√∂ka p√• ortnamn, sj√∂ar, b√§ckar, v√§gnummer, trafikplatser, byggnader, restauranger m.m.</li>
          <li>Koordinatsystem som st√∂ds √§r WGS84 dec, RT90 och SWEREF99</li>
          <li>S√∂k p√• socken genom att skriva t.ex. 'Hillesh√∂g socken'</li>
          <li>Socken-lagret beh√∂ver vara t√§nt f√∂r att det ska synas i pop up-rutan vilken socken en plats tillh√∂r</li>
          <li>F√∂r att hitta l√§nsv√§gar (LV), s√∂k p√• <a href="https://sv.wikipedia.org/wiki/L%C3%A4nsbokstav" target="_blank">l√§nsbokstav</a> + v√§gnummer, t.ex. AB 1035</li>
          <li>Riksv√§gar (RV) inleds inte med n√•gon bokstav</li>
          <li>Listan med f√∂rslag som visas efter en s√∂kning √§r begr√§nsad till 50 tr√§ffar</li>
        </ul>
      </div>
    </div>
  </div>

  <!-- Data Sources Modal -->
  <div id="sourcesModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Datak√§llor</h3>
        <button class="modal-close" onclick="closeModal('sources')">&times;</button>
      </div>
      <div class="modal-body">
        <p>Bakgrundskartan kommer fr√•n OpenStreetMap. Information om adress, kommun och l√§n h√§mtas via Nominatims geokodningstj√§nst.</p>
        
        <h4>Lagren som kan t√§ndas och sl√§ckas i kartan kommer fr√•n:</h4>
        <ul>
          <li>L√§n och kommun: Lantm√§teriets √∂ppna data 'Kommun, l√§n och rike'</li>
          <li>Landskap: Lantm√§teriets √∂ppna data 'Distriktsindelning'</li>
          <li>Socken: Lantm√§teriets √∂ppna data 'Socken och stad'</li>
          <li>Lappmarkerna √§r avgr√§nsade med hj√§lp av kommungr√§nser</li>
        </ul>
        
        <p><em>Information om l√§n och kommun kan skilja sig mellan OpenStreetMap/Nominatim och Lantm√§teriets data, s√§rskilt om punkten ligger mycket n√§ra en gr√§ns.</em></p>
      </div>
    </div>
  </div>

  <!-- Scripts - Load in proper order -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@turf/turf@6.5.0/turf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.6.2/proj4.js"></script>
  
  <!-- Your JavaScript file -->
  <script src="script.js"></script>
</body>
</html>