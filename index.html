<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>geoLocus</title>
  <!-- Huvudstilark√§lla -->
  <link rel="stylesheet" href="style.css">
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Jersey+10&display=swap" rel="stylesheet">
  <!-- Leaflet CSS (f√∂r kartan) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <!-- Font Awesome f√∂r ikoner -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
</head>
<body>
  <div class="wrapper">
    <header id="header">
      <div id="logo-container">
        <img src="geoLocus_small.png" alt="geoLocus logotyp" id="logo">
      </div>
      <nav class="tab-wrapper">
        <div class="tab-container">
          <button class="tab-button" onclick="openTab('main')">Karta</button>
          <button class="tab-button" onclick="openTab('converter')">Konvertera</button>
          <button class="tab-button" onclick="openTab('h√§mta-geodata')">H√§mta geodata</button>
        </div>
      </nav>
    </header>

    <!-- Inneh√•llsomslag f√∂r alla flikar -->
    <div class="content">
      <div id="main" class="tab-content">
        <main class="container">
          <!-- Rubriker -->
          <h2>Hitta platsens l√§n, kommun, landskap och lappmark</h2>
          
          <!-- üîç Kombinerad s√∂kning efter plats eller koordinater -->
          <section id="search-section">
            <div id="search">
              <input id="searchField" type="text" placeholder="S√∂k plats eller koordinat" 
              title="Se s√∂ktips l√§ngre ned">       
              <button id="searchButton">S√∂k</button>
              <button id="clearPinsButton">Rensa pins</button>
              <!-- Visar resultatlista fr√•n plats-s√∂kning -->
              <div id="results"></div>
            </div>
          </section>

          <!-- Avancerade s√∂kfilter i ett utf√§llbart avsnitt -->
          <details id="advancedSearchContainer">
            <summary>S√∂kfilter</summary>
            <div>
              <input type="checkbox" id="worldwideToggle">
              <label for="worldwideToggle">Till√•t s√∂ktr√§ffar utanf√∂r Sverige</label>
            </div>
            <div id="filterContainer">
              <select id="filterLan">
                <option value="">Alla l√§n</option>
                <option value="Blekinge l√§n">Blekinge l√§n</option>
                <option value="Dalarnas l√§n">Dalarnas l√§n</option>
                <option value="Gotlands l√§n">Gotlands l√§n</option>
                <option value="G√§vleborgs l√§n">G√§vleborgs l√§n</option>
                <option value="Hallands l√§n">Hallands l√§n</option>
                <option value="J√§mtlands l√§n">J√§mtlands l√§n</option>
                <option value="J√∂nk√∂pings l√§n">J√∂nk√∂pings l√§n</option>
                <option value="Kalmar l√§n">Kalmar l√§n</option>
                <option value="Kronobergs l√§n">Kronobergs l√§n</option>
                <option value="Norrbottens l√§n">Norrbottens l√§n</option>
                <option value="Sk√•ne l√§n">Sk√•ne l√§n</option>
                <option value="Stockholms l√§n">Stockholms l√§n</option>
                <option value="S√∂dermanlands l√§n">S√∂dermanlands l√§n</option>
                <option value="Uppsala l√§n">Uppsala l√§n</option>
                <option value="V√§rmlands l√§n">V√§rmlands l√§n</option>
                <option value="V√§sterbottens l√§n">V√§sterbottens l√§n</option>
                <option value="V√§sternorrlands l√§n">V√§sternorrlands l√§n</option>
                <option value="V√§stmanlands l√§n">V√§stmanlands l√§n</option>
                <option value="V√§stra G√∂talands l√§n">V√§stra G√∂talands l√§n</option>
                <option value="√ñrebro l√§n">√ñrebro l√§n</option>
                <option value="√ñsterg√∂tlands l√§n">√ñsterg√∂tlands l√§n</option>
              </select>
              
              <select id="filterLandskap">
                <option value="">Alla landskap</option>
                <option value="Blekinge">Blekinge</option>
                <option value="Bohusl√§n">Bohusl√§n</option>
                <option value="Dalarna">Dalarna</option>
                <option value="Dalsland">Dalsland</option>
                <option value="Gotland">Gotland</option>
                <option value="G√§strikland">G√§strikland</option>
                <option value="Halland">Halland</option>
                <option value="H√§lsingland">H√§lsingland</option>
                <option value="H√§rjedalen">H√§rjedalen</option>
                <option value="J√§mtland">J√§mtland</option>
                <option value="Medelpad">Medelpad</option>
                <option value="Norrbotten">Norrbotten</option>
                <option value="N√§rke">N√§rke</option>
                <option value="Sk√•ne">Sk√•ne</option>
                <option value="Sm√•land">Sm√•land</option>
                <option value="S√∂dermanland">S√∂dermanland</option>
                <option value="Uppland">Uppland</option>
                <option value="V√§rmland">V√§rmland</option>
                <option value="V√§sterbotten">V√§sterbotten</option>
                <option value="V√§sterg√∂tland">V√§sterg√∂tland</option>
                <option value="V√§stmanland">V√§stmanland</option>
                <option value="√Öngermanland">√Öngermanland</option>
                <option value="√ñland">√ñland</option>
                <option value="√ñsterg√∂tland">√ñsterg√∂tland</option>                 
              </select>
            </div>
          </details>
          
          <!-- üó∫Ô∏è Karta -->
          <section id="map-section">
            <div id="map"></div>
          </section>
          
          <!-- ‚ÑπÔ∏è S√∂ktips -->
          <section id="search-tips">
            <h3>S√∂ktips</h3>
            <details>
              <summary>Klicka f√∂r att visa</summary>
              <ul>
                <li>Du kan s√∂ka p√• ortnamn, sj√∂ar, b√§ckar, v√§gnummer, trafikplatser, byggnader, restauranger m.m.</li>
                <li>Koordinatsystem som st√∂ds √§r WGS84 dec, RT90 och SWEREF99</li>
                <li>S√∂k p√• socken genom att skriva t.ex. 'Hillesh√∂g socken'.</li>
                <li>Socken-lagret beh√∂ver vara t√§nt f√∂r att det ska synas i pop up-rutan vilken socken en plats tillh√∂r</li>
                <li>F√∂r att hitta l√§nsv√§gar (LV), s√∂k p√• <a href="https://sv.wikipedia.org/wiki/L%C3%A4nsbokstav" target="_blank" rel="noopener noreferrer">l√§nsbokstav</a> + v√§gnummer, t.ex. AB 1035</li>
                <li>Riksv√§gar (RV) inleds inte med n√•gon bokstav</li>
                <li>Listan med f√∂rslag som visas efter en s√∂kning √§r begr√§nsad till 50 tr√§ffar</li>
              </ul>
            </details>
          </section>
          
          <br>
          
          <!-- ‚ÑπÔ∏è Datak√§llor -->
          <section id="data-sources">
            <h3>Datak√§llor</h3>
            <p>Bakgrundskartan kommer fr√•n OpenStreetMap. Information om adress, kommun och l√§n h√§mtas via Nominatims geokodningstj√§nst.</p>
            <p>Lagren som kan t√§ndas och sl√§ckas i kartan kommer fr√•n:</p>
            <ul>
              <li>L√§n och kommun: Lantm√§teriets √∂ppna data 'Kommun, l√§n och rike'</li>
              <li>Landskap: Lantm√§teriets √∂ppna data 'Distriktsindelning'</li>
              <li>Socken: Lantm√§teriets √∂ppna data 'Socken och stad'</li>
              <li>Lappmarkerna √§r avgr√§nsade med hj√§lp av kommungr√§nser</li>
            </ul>
            <p>Dokumentation om respektive lager fr√•n Lantm√§teriet finns p√• deras hemsida.</p>
            <p>Information om l√§n och kommun kan skilja sig mellan OpenStreetMap/Nominatim och Lantm√§teriets data, s√§rskilt om punkten ligger mycket n√§ra en gr√§ns.</p>
          </section>
          <br>
        </main>
      </div>

      <div id="converter" class="tab-content" style="display: none;">
        <main class="container">
          <!-- üîÑ Koordinatkonvertering -->
          <h2>Konvertera koordinater</h2>
          <section id="coordinate-converter" class="converter-container">
            <!-- Inmatningsf√§lt -->
            <div class="converter-fields">
              <input type="text" id="wgs84Input" placeholder="WGS84 (Lat, Lon)">
              <input type="text" id="rt90Input" placeholder="RT90 (X, Y)">
              <input type="text" id="swerefInput" placeholder="SWEREF 99 (X, Y)">
              <button id="convertButton">Konvertera</button>
            </div>
            <br>
            <!-- Resultat -->
            <div id="conversion-results">
              <h3>Resultat:</h3>
              <p><strong>WGS84:</strong> <span id="wgs84Result">-</span></p>
              <p><strong>RT90:</strong> <span id="rt90Result">-</span></p>
              <p><strong>SWEREF99:</strong> <span id="swerefResult">-</span></p>
            </div>
          </section>
        </main>
      </div>

      <div id="h√§mta-geodata" class="tab-content" style="display: none;">
        <main class="container">
          <!-- üìÇ H√§mta geodata fr√•n koordinater -->
          <section id="geo-instructions">
            <h2>H√§mta geodata fr√•n koordinater</h2>
            <p>Ladda upp en Excel-fil med koordinater och f√• tillbaka en fil d√§r varje punkt kopplats till l√§n, landskap (eller lappmark), kommun, socken och adress.</p>
            <p>Adressen h√§mtas fr√•n OpenStreetMap. √ñvrig data h√§mtas fr√•n Lantm√§teriet.</p>
            <ol>
              <li>V√§lj din Excel-fil</li>
              <li>Klicka p√• <strong>"H√§mta geodata"</strong></li>
              <li>Den bearbetade filen laddas ner automatiskt</li>
            </ol>

            <!-- V√§lj datak√§lla -->
            <div id="dataSourceSelector">
              <label>
                <input type="radio" name="dataSource" value="lmOnly">
                H√§mta endast l√§n, kommun, landskap (snabbare)
              </label>
              <label>
                <input type="radio" name="dataSource" value="both" checked>
                H√§mta fullst√§ndig data (inkluderar √§ven socken, adress)
              </label>
            </div>

            <br>

            <!-- Filuppladdning f√∂r Excel + knapp f√∂r att starta bearbetning -->
            <div id="excel-upload">
              <label for="excelFile" class="custom-file-upload">
                <i class="fas fa-upload"></i> V√§lj fil
              </label>
              <input type="file" id="excelFile" accept=".xlsx,.xls" />
              <button id="processBtn">H√§mta geodata</button>
              <!-- Visar valt filnamn -->
              <span id="selectedFileName" class="file-info"></span>
            </div>
            <br>
            <!-- üìë Filformat & krav -->
            <h3>Filformat & krav</h3>
            <p>Filen du laddar upp ska vara i <strong>Excel-format</strong> (<code>.xlsx</code> eller <code>.xls</code>) och inneh√•lla f√∂ljande kolumner:</p>
            <table>
              <tbody>
                <tr>
                  <td><code>id</code></td>
                  <td>Unikt rad-ID (t.ex. katalognummer eller lokal-id; <em>valfritt</em>)</td>
                </tr>
                <tr>
                  <td><code>lat</code></td>
                  <td>Latitud i decimaltal</td>
                </tr>
                <tr>
                  <td><code>lon</code></td>
                  <td>Longitud i decimaltal</td>
                </tr>
              </tbody>
            </table>
            <br>
            <!-- ‚ÑπÔ∏è Viktig information -->
            <h3>Viktigt</h3>
            <ul>
              <li>Kolumnnamnen m√•ste skrivas exakt som ovan (sm√• bokst√§ver)</li>
              <li>Koordinaterna ska vara i WGS84</li>
              <li>Decimaler ska anges med punkt (<code>.</code>), inte komma (<code>,</code>)</li>
            </ul>
          </section>
        </main>
      </div>
    </div> <!-- .content -->

    <!-- Gemensam footer f√∂r alla flikar -->
    <footer>
      <a href="https://github.com/alotsa" target="_blank" class="github-link">
        <img src="https://cdn.jsdelivr.net/npm/simple-icons@v9/icons/github.svg" alt="GitHub" class="github-icon">
      </a>
    </footer>
  </div> <!-- .wrapper -->

  <!-- Skript -->
  <!-- Externa bibliotek -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@turf/turf@6.5.0/turf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.6.2/proj4.js"></script>
  <!-- Din egen JavaScript-fil -->
  <script src="script.js"></script>
</body>
</html>
